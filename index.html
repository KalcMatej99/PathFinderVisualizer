<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, shrink-to-fit=no">
    <title>Home - PathFindingVisualizer</title>
    <meta name="description" content="Our Path Finding Visualizer">
    <link rel="stylesheet" href="./Public/Stylesheet/Card-Deck.css">
    <link rel="stylesheet" href="./Public/Stylesheet/Multi-Select-Dropdown-by-Jigar-Mistry.css">
    <link rel="stylesheet" href="./Public/Stylesheet/select.css">
    <link rel="stylesheet" href="./Public/Stylesheet/bootstrap.min.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Montserrat:400,700">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato:400,700,400italic,700italic">
    <link rel="stylesheet" href="./Public/fonts/font-awesome.min.css">
    <link rel="stylesheet" href="./Public/Stylesheet/Studious-selectbox.css">
    <link rel="stylesheet" href="./Public/Stylesheet/4-Columns-Info-Icons.css">
    <style type="text/css">
        td {
            border: 1px solid #000;
        }

        .startNode {
            background-color: green;
        }

        .endNode {
            background-color: red;
        }
    </style>

</head>

<body id="page-top">
    <nav class="navbar navbar-light navbar-expand-lg fixed-top bg-secondary text-uppercase" id="mainNav">
        <div class="container"><a class="navbar-brand text-primary js-scroll-trigger" href="#page-top">Path Finding
                Visualizer</a><button data-toggle="collapse" data-target="#navbarResponsive"
                class="navbar-toggler navbar-toggler-right text-uppercase bg-primary text-white rounded"
                aria-controls="navbarResponsive" aria-expanded="false" aria-label="Toggle navigation"><i
                    class="fa fa-bars"></i></button>
            <div class="collapse navbar-collapse" id="navbarResponsive">
                <ul class="nav navbar-nav ml-auto">
                    <li class="nav-item mx-0 mx-lg-1" role="presentation"><a
                            class="nav-link text-primary py-3 px-0 px-lg-3 rounded js-scroll-trigger"
                            onclick="executePathFindingAlgorithm()">Start</a>
                    </li>
                    <li class="nav-item mx-0 mx-lg-1" role="presentation"><a
                            class="nav-link text-primary py-3 px-0 px-lg-3 rounded js-scroll-trigger"
                            onclick="clearCanvas()">Clear</a></li>
                    <li class="nav-item mx-0 mx-lg-1" role="presentation">
                        <form class="form-inline">
                            <div class="field"><select class="form-control" id="selectAlgorithm">
                                    <option value="1" selected="">Dijkstra</option>
                                    <option value="2">A*</option>
                                </select><label class="text-primary mb-0" for="float-input">Choose Algortihm</label>
                            </div>
                        </form>
                    </li>
                </ul>
            </div>
        </div>
    </nav>
    <header class="masthead bg-primary text-white text-center">
        <div class="container">
            <div class="row" style="column-gap: 40px;">
                <div class="col-12 col-sm-6 col-md-3 col-lg-3"
                    style="background-color: #ffffff; border-radius: 25px;column-gap: 40px;">
                    <h4 class="text-center" style="padding-top: 10px;">Start Vertex</h4>
                    <div class="login-card"><img class="profile-img-card" src="./Public/Images/goSign.png">
                    </div>
                </div>
                <div class="col-12 col-sm-6 col-md-3 col-lg-3"
                    style="background-color: #ffffff; border-radius: 25px;column-gap: 40px;">
                    <h4 class="text-center" style="padding-top: 10px;">End Vertex </h4>
                    <div class="login-card"><img class="profile-img-card" src="./Public/Images/finishFlag.png">
                    </div>
                </div>
            </div>
        </div>
    </header>
    <section>
        <div class="container">
            <div class="table-responsive">
                <table class="table">
                    <tbody id="tableBody">
                    </tbody>
                </table>
            </div>
        </div>
    </section>
    <footer class="footer text-center">
        <div class="container">
            <div class="row">
                <div class="col-md-4 mb-5 mb-lg-0">
                    <p class="lead mb-0"></p>
                </div>
                <div class="col-md-4 mb-5 mb-lg-0">
                    <h4 class="text-uppercase">Follow us</h4>
                    <ul class="list-inline">
                        <li class="list-inline-item"><a
                                class="btn btn-outline-light btn-social text-center rounded-circle" role="button"
                                href="https://www.facebook.com/matej.kalc.58"><i class="fa fa-facebook fa-fw"></i></a>
                        </li>
                        <li class="list-inline-item"><a
                                class="btn btn-outline-light btn-social text-center rounded-circle" role="button"
                                href="https://matejkalc.me/"><i class="fa fa-dribbble fa-fw"></i></a></li>
                        <li class="list-inline-item"><a
                                class="btn btn-outline-light btn-social text-center rounded-circle" role="button"
                                href="https://ninobrezac.me/"><i class="fa fa-dribbble fa-fw"></i></a></li>
                    </ul>
                </div>
                <div class="col-md-4">
                    <p class="lead mb-0"></p>
                </div>
            </div>
        </div>
    </footer>
    <div class="copyright py-4 text-center text-white">
        <div class="container"><small>Copyright Â©&nbsp;Matej Kalc, Nino Brezac 2020</small></div>
    </div>
    <div class="d-lg-none scroll-to-top position-fixed rounded"><a
            class="d-block js-scroll-trigger text-center text-white rounded" href="#page-top"><i
                class="fa fa-chevron-up"></i></a></div>

    <script src="./Public/Javascript/Multi-Select-Dropdown-by-Jigar-Mistry.js"></script>
    <script src="./Public/Javascript/jquery.min.js"></script>
    <script src="./Public/Javascript/bootstrap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-easing/1.4.1/jquery.easing.min.js"></script>
    <script src="./Public/Javascript/freelancer.js"></script>
    <script src="./Public/Javascript/Studious-selectbox.js"></script>
    <script src="./Public/algorithms/node.js"></script>
    <script src="./Public/algorithms/graph.js"></script>
</body>

<script>

    const tableBody = document.getElementById("tableBody");
    const widthOfNode = 30;
    const heightOfNode = 30;
    const numberOfColumns = tableBody.offsetWidth / widthOfNode;
    const numberOfRows = tableBody.offsetWidth / (4 * heightOfNode);

    const graph = new GridGraph(numberOfRows, numberOfColumns);

    $(document).ready(function () {
        createInitialeGraph();
        drawGraph(graph);
    });

    function createInitialeGraph() {
        for (var i = 0; i < numberOfRows; i += 1) {
            for (var j = 0; j < numberOfColumns; j += 1) {
                graph.setNode(i, j, new GridNode(i, j));
            }
        }

        
        graph.setStartNode(3,3);
        graph.setEndNode(3,5);
    }

    function drawGraph(graph) {

        tableBody.innerHTML = '';

        for (var i = 0; i < numberOfRows; i += 1) {
            var newRow = '<tr row="' + i + '" id="row-' + i + '" height="' + heightOfNode + '"></tr>';
            tableBody.insertAdjacentHTML('beforeend', newRow);
            var tableRow = document.getElementById("row-" + i);

            for (var j = 0; j < numberOfColumns; j += 1) {
                var newNode = '<td row="' + i + '" column="' + j + '" id="node-' + i + '-' + j + '" height="' + heightOfNode + '" width="' + widthOfNode + '" ondragstart="drag(event)" ondrop="drop(event)" ondragover="allowDrop(event)"></td>';
                tableRow.insertAdjacentHTML('beforeend', newNode);

            }
        }

        var startNode = graph.getStartNode();
        displayStartNode(startNode.row, startNode.column)

        var endNode = graph.getEndNode();
        displayEndNode(endNode.row, endNode.column)
    }

    function displayStartNode(r,c) {
        document.getElementById(getIdFor(r, c)).className = "startNode";
        document.getElementById(getIdFor(r, c)).draggable = true
    }
    function displayEndNode(r,c) {
        document.getElementById(getIdFor(r, c)).className = "endNode";
        document.getElementById(getIdFor(r, c)).draggable = true
    }

    function allowDrop(ev) {
        ev.preventDefault();
    }

    function drag(ev) {
        ev.dataTransfer.setData("position", ev.target.id);
    }

    function drop(ev) {
        ev.preventDefault();
        var draggedFrom = document.getElementById(ev.dataTransfer.getData("position"));
        var draggedTo = ev.target;
        var rowAndColumn = getRowAndColumnFromId(draggedTo.id);
        var rowOfDraggegTo = rowAndColumn[0];
        var columnOfDraggedTo = rowAndColumn[1];

        if (draggedFrom.classList.contains("startNode") && !draggedTo.classList.contains("endNode")) {
            draggedFrom.classList.remove("startNode");
            draggedFrom.draggable = false;
            draggedTo.className = "startNode";
            draggedTo.draggable = true
            graph.setStartNode(rowOfDraggegTo, columnOfDraggedTo);
        } else if (draggedFrom.classList.contains("endNode") && !draggedTo.classList.contains("startNode")) {
            draggedFrom.classList.remove("endNode");
            draggedFrom.draggable = false;
            draggedTo.className = "endNode";
            draggedTo.draggable = true
            graph.setEndNode(rowOfDraggegTo, columnOfDraggedTo);
        }
    }

    function executePathFindingAlgorithm() {
        var idPathFindingAlgorithm = document.getElementById("selectAlgorithm").options[document.getElementById("selectAlgorithm").selectedIndex].value;

        var statesToDisplay = [];

        switch (idPathFindingAlgorithm) {
            case 1: statesToDisplay = dijkstra(graph); break;
            case 2: statesToDisplay = astar(graph); break;
            default: break;
        }

        displayStates(statesToDisplay, 100);
    }

    function displayStates(states, speed) {
        var indexState = 0;
        for (var count = 0; count < states.length; count++) {

            setTimeout(() => {
                if (states != null && indexState < states.length) {
                    drawGraph(states[indexState])
                    indexState++;
                    if (indexTable >= states.length) {
                        clearAllTimeouts();
                        states = null;
                    }
                }
            }, speed * count);
        }
    }

    function clearAllTimeouts() {
        var highestTimeoutId = setTimeout(";");
        for (var i = 0; i < highestTimeoutId; i++) {
            clearTimeout(i);
        }
    }

    function getIdFor(r, c) {
        return 'node-' + r + '-' + c;
    }

    function getRowAndColumnFromId(id) {
        return [parseInt(id.substring(5, 6), 10), parseInt(id.substring(7, 8), 10)];
    }
</script>

</html>