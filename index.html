<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, shrink-to-fit=no">
    <title>Home - PathFindingVisualizer</title>
    <meta name="description" content="Our Path Finding Visualizer">
    <link rel="stylesheet" href="./Public/Stylesheet/Multi-Select-Dropdown-by-Jigar-Mistry.css">
    <link rel="stylesheet" href="./Public/Stylesheet/select.css">
    <link rel="stylesheet" href="./Public/Stylesheet/bootstrap.min.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Montserrat:400,700">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato:400,700,400italic,700italic">
    <link rel="stylesheet" href="./Public/fonts/font-awesome.min.css">
    <style type="text/css">
        td,
        tbody,
        table {
            border: 1px solid #000;
        }

        .node {
            padding: 0rem;
            vertical-align: top;
        }

        .node-visited {
            background-color: yellow;
        }

        .node-in-path {
            background-color: red;
        }

        html,
        body {
            margin: 0;
            height: 100%;
            overflow: hidden
        }
    </style>

</head>

<body id="page-top">
    <nav class="navbar navbar-light navbar-expand-lg fixed-top bg-secondary text-uppercase" id="mainNav">
        <div class="container"><a class="navbar-brand js-scroll-trigger" href="#page-top">Path Finding
                Visualizer</a><button data-toggle="collapse" data-target="#navbarResponsive"
                class="navbar-toggler navbar-toggler-right text-uppercase bg-primary text-white rounded"
                aria-controls="navbarResponsive" aria-expanded="false" aria-label="Toggle navigation"><i
                    class="fa fa-bars"></i></button>
            <div class="collapse navbar-collapse" id="navbarResponsive">
                <ul class="nav navbar-nav ml-auto">
                    <li class="nav-item mx-0 mx-lg-1" role="presentation"><a
                            class="nav-link py-3 px-0 px-lg-3 rounded js-scroll-trigger" style="color: #ffffff;"
                            onclick="executePathFindingAlgorithm(true)">Start</a>
                    </li>
                    <li class="nav-item mx-0 mx-lg-1" role="presentation"><a
                            class="nav-link py-3 px-0 px-lg-3 rounded js-scroll-trigger" style="color: #ffffff;"
                            onclick="clearGraph()">Clear</a></li>
                    <li class="nav-item mx-0 mx-lg-1" role="presentation">
                        <form class="form-inline"><select class="form-control" id="selectAlgorithm"
                                style="background-color: rgba(255,255,255,0);color: rgb(255,255,255);border-color: rgba(255,255,255,0);">
                                <option value="1" selected="">Dijkstra</option>
                                <option value="2">A*</option>
                                <option value="3">DFS</option>
                            </select></form>
                    </li>
                </ul>
            </div>
        </div>
    </nav>
    <main>
        <br>
        <section>
            <div class="container">
                <h3 style="text-align: center">Select an algorithm and click START</h3>
                <div class="card-group">
                    <div class="card">
                        <div class="card-body">
                            <div class="row">
                                <div class="col">
                                    <img width="60px" height="60px" src="./Public/Images/goSign.png"></div>
                                <div class="col">
                                    <h4 class="card-title">Start Node</h4>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="card">
                        <div class="card-body">
                            <div class="row">
                                <div class="col">
                                    <img width="60px" height="60px" src="./Public/Images/finishFlag.png"></div>
                                <div class="col">
                                    <h4 class="card-title">End Node</h4>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="card">
                        <div class="card-body">
                            <div class="row">
                                <div class="col">
                                    <img width="60px" height="60px" src="./Public/Images/yellowBlock.png">
                                </div>
                                <div class="col">
                                    <h4 class="card-title">Visited Node</h4>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="card">
                        <div class="card-body">
                            <div class="row">
                                <div class="col">
                                    <img width="60px" height="60px" src="./Public/Images/redBlock.png">
                                </div>
                                <div class="col">
                                    <h4 class="card-title">Node In Path</h4>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <br>
            <div class="table-responsive">
                <table class="table">
                    <tbody id="tableBody">
                    </tbody>
                </table>
            </div>
        </section>

        <!-- Modal -->
        <div class="modal fade" id="informationModal" role="dialog">
            <div class="modal-dialog modal-lg">
                <div class="modal-content">
                    <div class="modal-header">
                        <h4 class="modal-title">Path Finding Visualizer</h4>
                    </div>
                    <div class="modal-body">
                        <p>This page shows graphically how each path finding algorithm works.</p>
                        <p>A grid is shown with start and end nodes.</p>
                        <p>Start and end nodes are draggable, you can move those on the grid.</p>
                        <p>When ready select the algorithm and click START in the navbar.</p>
                        <p>Click CLEAR to clean the grid and start over.</p>
                        <p>The site works on mobile and on PC/Desktop, but it has been optimised for PC/Desktop</p>
                        <p>To continue click 'Ok'.</p>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-default" data-dismiss="modal">Ok</button>
                    </div>
                </div>

            </div>
        </div>
    </main>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-easing/1.4.1/jquery.easing.min.js"></script>
    <script src="./Public/Javascript/freelancer.js"></script>
    <script src="./Public/algorithms/node.js"></script>
    <script src="./Public/algorithms/graph.js"></script>
    <script src="./Public/algorithms/dijkstra.js"></script>
    <script src="./Public/algorithms/DFS.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="./Public/Javascript/bootstrap.min.js"></script>
</body>

<script>

    const tableBody = document.getElementById("tableBody");
    const widthOfNode = 25;
    const heightOfNode = 25;
    const numberOfColumns = parseInt(tableBody.getBoundingClientRect().width / widthOfNode, 10);
    const numberOfRows = parseInt((window.innerHeight - tableBody.getBoundingClientRect().y) / heightOfNode, 10);
    const pathToGoSign = "./Public/Images/goSign.png";
    const pathToFinishFlag = "./Public/Images/finishFlag.png";
    var animationIsExecuting = false;
    var isShownPath = false;

    var graph = new GridGraph(numberOfRows, numberOfColumns);

    $(document).ready(function () {
        createInitialeGraph();
        drawGraph(graph);
        $('#informationModal').modal('show');
    });

    function createInitialeGraph() {
        isShownPath = false;
        console.log(numberOfColumns);
        console.log(numberOfRows);
        for (var i = 0; i < numberOfRows; i += 1) {
            for (var j = 0; j < numberOfColumns; j += 1) {
                graph.setNode(i, j, new GridNode(i, j));
            }
        }

        graph.setStartNode(3, 3);
        graph.setEndNode(3, 5);
    }

    function drawGraph(graph) {

        tableBody.innerHTML = '';

        for (var i = 0; i < numberOfRows; i += 1) {
            var newRow = '<tr row="' + i + '" id="row-' + i + '" height="' + heightOfNode + '"></tr>';
            tableBody.insertAdjacentHTML('beforeend', newRow);
            var tableRow = document.getElementById("row-" + i);

            for (var j = 0; j < numberOfColumns; j += 1) {
                var newNode = '<td class="node" row="' + i + '" column="' + j + '" id="node-' + i + '-' + j + '" height="' + heightOfNode + '" width="' + widthOfNode + '" ondragstart="drag(event)" ondrop="drop(event)" ondragover="allowDrop(event)"></td>';
                tableRow.insertAdjacentHTML('beforeend', newNode);

                document.getElementById('node-' + i + '-' + j).style.padding = 0;

                if (graph.getNode(i, j).visited) {
                    document.getElementById('node-' + i + '-' + j).classList.add("node-visited");
                } else {
                    document.getElementById('node-' + i + '-' + j).classList.remove("node-visited");
                }

                document.getElementById('node-' + i + '-' + j).classList.remove("node-in-path");

            }
        }

        var startNode = graph.getStartNode();
        displayStartNode(startNode.row, startNode.column);

        var endNode = graph.getEndNode();
        displayEndNode(endNode.row, endNode.column);

        if (graph.pathIsFound) {
            drawPathInGraph(graph);
        }

        this.graph = graph;
    }



    function drawPathInGraph(graph) {
        var path = graph.path();
        var indexNode = 0;
        //clearAllTimeouts();

        for (var count = 0; count < path.length; count++) {

            setTimeout(() => {

                if (path != null && indexNode < path.length) {

                    var nodeInPath = path[indexNode];
                    var rowOfNodeInPath = nodeInPath.row;
                    var columnOfNodeInPath = nodeInPath.column;
                    document.getElementById(getIdFor(rowOfNodeInPath, columnOfNodeInPath)).classList.add("node-in-path");
                    indexNode += 1;
                    if (indexNode >= path.length) {
                        //clearAllTimeouts();
                        isShownPath = true;
                        path = null;
                        animationIsExecuting = false;
                    }
                }
            }, 100 * count);
        }
    }

    function clearGraph() {
        isShownPath = false;
        clearAllTimeouts();
        graph.clean();
        createInitialeGraph();
        drawGraph(graph);
    }

    function displayStartNode(r, c) {
        document.getElementById(getIdFor(r, c)).classList.add("startNode");
        document.getElementById(getIdFor(r, c)).draggable = true
        document.getElementById(getIdFor(r, c)).insertAdjacentHTML('beforeend', '<img style="object-fit: cover;" width="28px" height="28px" src="' + pathToGoSign + '"></img>');
    }
    function displayEndNode(r, c) {
        document.getElementById(getIdFor(r, c)).classList.add("endNode");
        document.getElementById(getIdFor(r, c)).draggable = true
        document.getElementById(getIdFor(r, c)).insertAdjacentHTML('beforeend', '<img style="object-fit: cover;" width="28px" height="28px" src="' + pathToFinishFlag + '"></img>');
    }

    function allowDrop(ev) {
        ev.preventDefault();
    }

    function drag(ev) {
        if (!animationIsExecuting) {
            var id = ev.target.id;
            if (id == null || id == '')
                id = ev.target.parentElement.id;

            ev.dataTransfer.setData("position", id);
        }
    }

    function drop(ev) {
        ev.preventDefault();

        if (!animationIsExecuting) {
            var rowAndColumnOfNodeTo = getRowAndColumnFromId(ev.target.id == '' ? ev.target.parentElement.id : ev.target.id);
            var nodeTo = graph.getNode(rowAndColumnOfNodeTo[0], rowAndColumnOfNodeTo[1]);

            var rowAndColumnOfNodeFrom = getRowAndColumnFromId(ev.dataTransfer.getData("position"));
            var nodeFrom = graph.getNode(rowAndColumnOfNodeFrom[0], rowAndColumnOfNodeFrom[1]);

            if (nodeFrom.isStartNode && !nodeTo.isEndNode) {

                var isPathDrawn = graph.isPathFound();
                graph.setStartNode(nodeTo.row, nodeTo.column);
                if (isPathDrawn) {
                    executePathFindingAlgorithm(false);
                } else {
                    drawGraph(graph);
                }

            } else if (nodeFrom.isEndNode && !nodeTo.isStartNode) {

                var isPathDrawn = graph.isPathFound();
                graph.setEndNode(nodeTo.row, nodeTo.column);

                if (isPathDrawn) {
                    executePathFindingAlgorithm(false);
                } else drawGraph(graph);
            }
        }

    }

    function executePathFindingAlgorithm(animate) {
        if (animationIsExecuting) return;
        animationIsExecuting = true;
        var idPathFindingAlgorithm = document.getElementById("selectAlgorithm").options[document.getElementById("selectAlgorithm").selectedIndex].value;
        idPathFindingAlgorithm = parseInt(idPathFindingAlgorithm, 10);
        var statesToDisplay = [];

        switch (idPathFindingAlgorithm) {
            case 1:
                statesToDisplay = dijkstra(graph); break;
            case 2: alert("Sorry this algorithm is not yet implemented"); break;//statesToDisplay = astar(graph); break;
            case 3: statesToDisplay = DFS(graph); break;
            default: break;
        }

        if (animate)
            displayStates(statesToDisplay, 100);
        else
            drawGraph(statesToDisplay[statesToDisplay.length - 1]);
    }

    function displayStates(states, speed) {
        var indexState = 0;
        for (var count = 0; count < states.length; count++) {

            setTimeout(() => {
                if (states != null && indexState < states.length) {
                    if (indexState - 1 == states.length) isShownPath = true;
                    drawGraph(states[indexState])
                    indexState++;
                    if (indexState >= states.length) {
                        //clearAllTimeouts();
                        states = null;
                        animationIsExecuting = false;
                    }
                }
            }, speed * count);
        }
    }

    function clearAllTimeouts() {
        var highestTimeoutId = setTimeout(";");
        for (var i = 0; i < highestTimeoutId; i++) {
            clearTimeout(i);
        }
        animationIsExecuting = false;
    }

    function getIdFor(r, c) {
        return 'node-' + r + '-' + c;
    }

    function getRowAndColumnFromId(id) {
        return [id.split("-")[1], id.split("-")[2]];
    }
</script>

</html>



<!--
<header class="masthead bg-primary text-white text-center">
    <div class="container">
        <div class="row">
            <div class="col">
                <div><p>Halooo</p></div>
            </div>
            <div class="col">
                <div><p>Banaaaana</p></div>
            </div>
        </div>
    </div>
</header> -->