<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, shrink-to-fit=no">
    <title>Home - PathFindingVisualizer</title>
    <meta name="description" content="Our Path Finding Visualizer">
    <link rel="stylesheet" href="./Public/Stylesheet/Multi-Select-Dropdown-by-Jigar-Mistry.css">
    <link rel="stylesheet" href="./Public/Stylesheet/select.css">
    <link rel="stylesheet" href="./Public/Stylesheet/bootstrap.min.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Montserrat:400,700">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato:400,700,400italic,700italic">
    <link rel="stylesheet" href="./Public/fonts/font-awesome.min.css">
    <style type="text/css">
        td,
        tbody,
        table {
            border: 1px solid #000;
        }

        .node {
            padding: 0rem;
            vertical-align: top;
        }

        .node-visited {
            background-color: yellow;
        }

        .node-in-path {
            background-color: red;
        }

        .node-wall {
            background-color: brown;
        }

        html,
        body {
            margin: 0;
            height: 100%;
            overflow: hidden
        }

        .unselectable {
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            -khtml-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
            height: 100%;
            width: 100%;
        }
    </style>

</head>

<body id="page-top">
    <nav class="navbar navbar-light navbar-expand-lg fixed-top bg-secondary text-uppercase" id="mainNav">
        <div class="container"><a class="navbar-brand js-scroll-trigger" href="#page-top">Path Finding
                Visualizer</a><button data-toggle="collapse" data-target="#navbarResponsive"
                class="navbar-toggler navbar-toggler-right text-uppercase bg-primary text-white rounded"
                aria-controls="navbarResponsive" aria-expanded="false" aria-label="Toggle navigation"><i
                    class="fa fa-bars"></i></button>
            <div class="collapse navbar-collapse" id="navbarResponsive">
                <ul class="nav navbar-nav ml-auto">
                    <li class="nav-item mx-0 mx-lg-1" role="presentation"><a
                            class="nav-link py-3 px-0 px-lg-3 rounded js-scroll-trigger" style="color: #ffffff;"
                            onclick="executePathFindingAlgorithm(true)">Start</a>
                    </li>
                    <li class="nav-item mx-0 mx-lg-1" role="presentation"><a
                            class="nav-link py-3 px-0 px-lg-3 rounded js-scroll-trigger" style="color: #ffffff;"
                            onclick="clearGraph()">Clear</a></li>
                    <li class="nav-item mx-0 mx-lg-1" role="presentation">
                        <form class="form-inline"><select class="form-control" id="selectAlgorithm"
                                style="color: rgb(0,0,0);">">
                                <option value="1" selected="">Dijkstra</option>
                                <option value="2">A*</option>
                                <option value="3">DFS</option>
                            </select></form>
                    </li>
                    <li class="nav-item mx-0 mx-lg-1" role="presentation">
                        <button class="btn btn-primary" onclick="showInstructions()">Show instructions</button></li>
                </ul>
            </div>
        </div>
    </nav>
    <main>
        <br>
        <section>
            <div class="container">
                <h3 style="text-align: center">Select an algorithm and click START</h3>
            </div>
            <br>
            <div class="table-responsive">
                <table class="table">
                    <tbody id="tableBody">
                    </tbody>
                </table>
            </div>
        </section>

        <!-- Modal -->
        <div class="modal fade" id="informationModal" role="dialog">
            <div class="modal-dialog modal-lg">
                <div class="modal-content">
                    <div class="modal-header">
                        <h4 class="modal-title">Path Finding Visualizer</h4>
                    </div>
                    <div class="modal-body">
                        <p>This page shows graphically how each path finding algorithm works.</p>
                        <p>A grid is shown with start and end nodes.</p>
                        <div class="card-group">
                            <div class="card">
                                <div class="card-body">
                                    <div class="row">
                                        <div class="col">
                                            <img width="40px" height="40px" src="./Public/Images/goSign.png"></div>
                                        <div class="col">
                                            <p class="card-title">Start Node</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="card">
                                <div class="card-body">
                                    <div class="row">
                                        <div class="col">
                                            <img width="40px" height="40px" src="./Public/Images/finishFlag.png"></div>
                                        <div class="col">
                                            <p class="card-title">End Node</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="card">
                                <div class="card-body">
                                    <div class="row">
                                        <div class="col">
                                            <img width="40px" height="40px" src="./Public/Images/yellowBlock.png">
                                        </div>
                                        <div class="col">
                                            <p class="card-title">Visited Node</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="card">
                                <div class="card-body">
                                    <div class="row">
                                        <div class="col">
                                            <img width="40px" height="40px" src="./Public/Images/redBlock.png">
                                        </div>
                                        <div class="col">
                                            <p class="card-title">Node In Path</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="card">
                                <div class="card-body">
                                    <div class="row">
                                        <div class="col">
                                            <img width="40px" height="40px" src="./Public/Images/wall.png">
                                        </div>
                                        <div class="col">
                                            <p class="card-title">Wall</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <p>Start and end nodes are draggable, you can move those on the grid.</p>
                        <p>When ready select the algorithm and click START in the navbar.</p>
                        <p>Click CLEAR to clean the grid and start over.</p>
                        <p>The site works only on PC/Desktop.</p>
                        <p>To continue click 'Ok'.</p>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-default" data-dismiss="modal">Ok</button>
                    </div>
                </div>

            </div>
        </div>
        <!-- Modal -->
        <div class="modal fade" id="noMobileUsageModal" role="dialog">
            <div class="modal-dialog modal-lg">
                <div class="modal-content">
                    <div class="modal-header">
                        <h4 class="modal-title">Path Finding Visualizer</h4>
                    </div>
                    <div class="modal-body">
                        <p>This page shows graphically how each path finding algorithm works.</p>
                        <p>Start and end nodes are draggable, you can move those on the grid.</p>
                        <p>When ready select the algorithm and click START in the navbar.</p>
                        <p>Click CLEAR to clean the grid and start over.</p>
                        <p>The site works only on PC/Desktop.</p>
                        <p>Please try again on a PC/Desktop.</p>
                    </div>
                </div>

            </div>
        </div>
    </main>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-easing/1.4.1/jquery.easing.min.js"></script>
    <script src="./Public/Javascript/freelancer.js"></script>
    <script src="./Public/algorithms/node.js"></script>
    <script src="./Public/algorithms/graph.js"></script>
    <script src="./Public/algorithms/dijkstra.js"></script>
    <script src="./Public/algorithms/DFS.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="./Public/Javascript/bootstrap.min.js"></script>
    <script src="./Public/Javascript/constants.js"></script>
    <script src="./Public/Javascript/utility.js"></script>
    <script src="./Public/Javascript/drawing.js"></script>
</body>

<script>

    var animationIsExecuting = false;
    var isShownPath = false;
    var graph = new GridGraph(numberOfRows, numberOfColumns);

    $(document).ready(function () {
        if (deviceIsPhone()) {
            showNoMobileUsage();
            alert("Page available only on PC/Desktop");
        } else {
            createInitialeGraph();
            drawGraph(graph);
            showInstructions();
        }
    });

    function showInstructions() {
        $('#informationModal').modal('show');
    }
    function showNoMobileUsage() {
        $('#noMobileUsageModal').modal('show');
    }
    function deviceIsPhone() {
        return isMobile.any() != null;
    }

    function createInitialeGraph() {
        isShownPath = false;
        animationIsExecuting = false;
        for (var i = 0; i < numberOfRows; i += 1) {
            for (var j = 0; j < numberOfColumns; j += 1) {
                graph.setNode(i, j, new GridNode(i, j));
            }
        }

        graph.setStartNode(parseInt(numberOfRows / 2, 10), parseInt(numberOfColumns / 2, 10) - 3);
        graph.setEndNode(parseInt(numberOfRows / 2, 10), parseInt(numberOfColumns / 2, 10) + 3);
    }

    function clearGraph() {
        isShownPath = false;
        animationIsExecuting = false;
        clearAllTimeouts();
        graph = new GridGraph(numberOfRows, numberOfColumns);
        createInitialeGraph();
        drawGraph(graph);
    }

    function allowDrop(ev) {
        ev.preventDefault();
    }

    function drag(ev) {
        if (!animationIsExecuting) {
            canMakeWalls = false;
            var id = ev.target.id;
            if (id == null || id == '')
                id = ev.target.parentElement.id;

            ev.dataTransfer.setData("position", id);
        }
    }

    function drop(ev) {
        ev.preventDefault();

        if (!animationIsExecuting) {
            canMakeWalls = false;
            var rowAndColumnOfNodeTo = getRowAndColumnFromId(ev.target.id == '' ? ev.target.parentElement.id : ev.target.id);
            var nodeTo = graph.getNode(rowAndColumnOfNodeTo[0], rowAndColumnOfNodeTo[1]);

            var rowAndColumnOfNodeFrom = getRowAndColumnFromId(ev.dataTransfer.getData("position"));
            var nodeFrom = graph.getNode(rowAndColumnOfNodeFrom[0], rowAndColumnOfNodeFrom[1]);

            if (nodeFrom.isStartNode && !nodeTo.isEndNode) {

                var isPathDrawn = graph.isPathFound();
                graph.setStartNode(nodeTo.row, nodeTo.column);
                if (isPathDrawn) {
                    executePathFindingAlgorithm(false);
                } else {
                    drawGraph(graph);
                }

            } else if (nodeFrom.isEndNode && !nodeTo.isStartNode) {

                var isPathDrawn = graph.isPathFound();
                graph.setEndNode(nodeTo.row, nodeTo.column);

                if (isPathDrawn) {
                    executePathFindingAlgorithm(false);
                } else drawGraph(graph);
            }
            canMakeWalls = true;
            mouseDown = false;
        }
    }

    function executePathFindingAlgorithm(animate) {
        if (animationIsExecuting) return;

        console.log(this.graph.getWalls());
        animationIsExecuting = true;
        isShownPath = false;
        var idPathFindingAlgorithm = document.getElementById("selectAlgorithm").options[document.getElementById("selectAlgorithm").selectedIndex].value;
        idPathFindingAlgorithm = parseInt(idPathFindingAlgorithm, 10);
        var statesToDisplay = [];

        switch (idPathFindingAlgorithm) {
            case 1:
                statesToDisplay = dijkstra(graph); break;
            case 2: alert("Sorry this algorithm is not yet implemented"); break;//statesToDisplay = astar(graph); break;
            case 3: statesToDisplay = DFS(graph); break;
            default: break;
        }

        if (animate)
            displayStates(statesToDisplay, speedOfAnimation);
        else
            drawGraph(statesToDisplay[statesToDisplay.length - 1]);
    }

    window.onresize = function(){
        window.location.reload(false);
    }

</script>

</html>